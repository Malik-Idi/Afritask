<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Admin | Afritask</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">
</head>
<body class="bg-slate-900 text-white min-h-screen p-10">
    <div class="max-w-5xl mx-auto">
        <header class="flex justify-between items-end mb-12">
            <div>
                <h1 class="text-4xl font-black mb-2">Panel de Gestion</h1>
                <p class="text-slate-400 font-mono text-sm">PROPRIÉTAIRE : AFRITASK</p>
            </div>
            <div class="bg-emerald-500/10 border border-emerald-500/50 p-6 rounded-3xl text-right">
                <p class="text-xs uppercase font-bold text-emerald-400 mb-1">Ma Commission (25%)</p>
                <p class="text-4xl font-black text-white" id="monSolde">0 F CFA</p>
            </div>
        </header>

        <h2 class="text-xl font-bold mb-6 text-slate-300">Demandes en attente</h2>
        <div id="liste" class="grid gap-6"></div>
    </div>

    <script>
        function load() {
            const missions = JSON.parse(localStorage.getItem('missions_pending') || "[]");
            document.getElementById('monSolde').innerText = (localStorage.getItem('admin_balance') || 0) + " F CFA";
            const container = document.getElementById('liste');

            if(missions.length === 0) {
                container.innerHTML = `<p class="italic text-slate-500">Aucune nouvelle demande...</p>`;
                return;
            }

            container.innerHTML = missions.map((m, i) => `
                <div class="bg-slate-800 p-8 rounded-3xl border border-slate-700 flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold">${m.nom}</h3>
                        <p class="text-indigo-400 italic">${m.url}</p>
                        <p class="mt-2 text-slate-400">${m.testeurs} testeurs demandés</p>
                    </div>
                    <div class="text-right">
                        <p class="text-emerald-400 font-black text-xl mb-4">+ ${m.fraisAdmin} F</p>
                        <button onclick="valider(${i})" class="bg-emerald-500 hover:bg-emerald-600 text-slate-900 px-8 py-3 rounded-xl font-black transition">ACCEPTER & ENCAISSER</button>
                    </div>
                </div>
            `).join('');
        }

        function valider(i) {
            let missions = JSON.parse(localStorage.getItem('missions_pending') || "[]");
            let m = missions[i];
            
            // Créditer l'admin
            let solde = parseInt(localStorage.getItem('admin_balance') || 0);
            localStorage.setItem('admin_balance', solde + m.fraisAdmin);

            // Publier pour les travailleurs
            let pubs = JSON.parse(localStorage.getItem('missions_publiques') || "[]");
            pubs.push(m);
            localStorage.setItem('missions_publiques', JSON.stringify(pubs));

            // Retirer de la liste
            missions.splice(i, 1);
            localStorage.setItem('missions_pending', JSON.stringify(missions));
            
            load();
            alert("Commission de " + m.fraisAdmin + " F encaissée ! Mission publiée.");
        }
        load();
    </script>
</body>
</html>
